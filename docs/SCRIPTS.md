# Отчёт по скриптам проекта

Запуск всех команд — из **корня проекта** (`bot-accounting`). Рекомендуется активировать виртуальное окружение: `venv\Scripts\activate` (Windows) или `source venv/bin/activate` (Linux/macOS).

---

## Основное приложение

| Команда | Описание |
|--------|----------|
| `python -m src.main` | Запуск Telegram-бота. Требуется `BOT_TOKEN` в `.env`. |

---

## Скрипты в каталоге `scripts/`

### 1. Состояние склада — `show_warehouse.py`

**Назначение:** выводит в консоль отчёт «СОСТОЯНИЕ СКЛАДА»: таблица активов с колонками «Название», «Категория», «На складе», «Назначено», «Цена», «Фото» (приход), «Фото возврат» (количество), итоги. Данные читаются из БД (`DB_PATH` из `.env`).

**Запуск:**
```bash
python scripts/show_warehouse.py
```

**Требования:** существующая БД (файл создаётся при первом запуске бота или при вызове `init_db`).

---

### 2. Очистка данных по имуществу — `clear_assets_db.py`

**Назначение:** удаляет из БД все данные, связанные с имуществом: активы, экземпляры активов, операции, заявки на возврат, фото возвратов, категории. **Пользователи и логи не удаляются.** Используется для проверки работы на «чистой» базе по имуществу.

**Запуск:**
```bash
python scripts/clear_assets_db.py
```
С запросом подтверждения перед удалением.

```bash
python scripts/clear_assets_db.py --yes
```
Без запроса (сразу выполнить очистку).

```bash
python scripts/clear_assets_db.py --dry-run
```
Только показать, сколько записей будет удалено по каждой таблице, **без изменений в БД**.

**Требования:** файл БД должен существовать (`DB_PATH`).

---

### 3. Миграция БД — `migrate_db.py`

**Назначение:** одноразовая миграция таблицы `assets`: переход с колонки «категория» (строка) на `category_id` (внешний ключ на `categories`). Нужна только для старых баз, созданных до введения таблицы категорий. Для новых установок не требуется — схема создаётся уже с `category_id`.

**Запуск:**
```bash
python scripts/migrate_db.py
```

**Поведение:** проверяет наличие старой колонки `category` и новой `category_id`; при необходимости создаёт новую таблицу, переносит данные с маппингом имён категорий в ID, переименовывает таблицу. При уже выполненной миграции выводит сообщение и ничего не меняет.

---

## Краткая сводка

| Скрипт | Команда | Что делает |
|--------|--------|------------|
| Бот | `python -m src.main` | Запуск Telegram-бота |
| Склад | `python scripts/show_warehouse.py` | Вывод таблицы состояния склада |
| Очистка | `python scripts/clear_assets_db.py` [--yes \| --dry-run] | Удаление данных по имуществу (без пользователей) |
| Миграция | `python scripts/migrate_db.py` | Миграция assets: category → category_id |

Файл БД по умолчанию: `./data/db.sqlite3` (настраивается через `DB_PATH` в `.env`).
